'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { \n  LineChart, Line, BarChart, Bar, ScatterChart, Scatter, \n  XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, \n  RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis,\n  Heatmap, HeatmapCell, PieChart, Pie, Cell, AreaChart, Area,\n  ComposedChart\n} from 'recharts';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Slider } from '@/components/ui/slider';\nimport { Switch } from '@/components/ui/switch';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  Search, \n  Filter, \n  Download, \n  Play, \n  Pause, \n  RefreshCw, \n  BarChart3, \n  TrendingUp, \n  Cpu, \n  Zap, \n  Shield, \n  AlertTriangle,\n  ChevronRight,\n  ChevronLeft,\n  Activity,\n  Globe,\n  Layers,\n  AlertCircle,\n  Target,\n  PieChart as PieChartIcon,\n  Network,\n  TrendingDown,\n  MessageSquare,\n  Twitter,\n  Reddit,\n  Hash,\n  TrendingUp as TrendingUpIcon,\n  TrendingDown as TrendingDownIcon,\n  Bell,\n  Users,\n  Hash as HashIcon,\n  BarChart2,\n  Link as LinkIcon,\n  FileText,\n  FileSpreadsheet,\n  Calculator,\n  Cpu as CpuIcon,\n  Wind,\n  Target as TargetIcon,\n  AlertOctagon,\n  TrendingUp as TrendingUpIcon2,\n  TrendingDown as TrendingDownIcon2,\n  BarChart as BarChartIcon,\n  LineChart as LineChartIcon,\n  Newspaper,\n  TrendingUp as TrendingUpIcon3,\n  TrendingDown as TrendingDownIcon3,\n  AlertCircle as AlertCircleIcon,\n  Activity as ActivityIcon,\n  Hash as HashIcon2,\n  MessageSquare as MessageSquareIcon,\n  Globe as GlobeIcon,\n  Users as UsersIcon,\n  Bell as BellIcon,\n  Filter as FilterIcon,\n  Download as DownloadIcon,\n  AlertTriangle as AlertTriangleIcon,\n  Shield as ShieldIcon,\n  TrendingDown as TrendingDownIcon4,\n  TrendingUp as TrendingUpIcon4,\n  BarChart3 as BarChart3Icon,\n  PieChart as PieChartIcon2,\n  Network as NetworkIcon,\n  Layers as LayersIcon,\n  Target as TargetIcon2,\n  Wind as WindIcon,\n  Calculator as CalculatorIcon,\n  FileSpreadsheet as FileSpreadsheetIcon,\n  AlertOctagon as AlertOctagonIcon\n} from 'lucide-react';\n\n// Types\ninterface StatisticalArbitragePair {\n  id: string;\n  asset1: string;\n  asset2: string;\n  correlation: number;\n  spread: number;\n  zScore: number;\n  halfLife: number;\n  entryThreshold: number;\n  exitThreshold: number;\n  sharpeRatio: number;\n  status: 'active' | 'inactive' | 'alert';\n}\n\ninterface MLFeature {\n  name: string;\n  type: 'technical' | 'fundamental' | 'market' | 'sentiment';\n  importance: number;\n  correlation: number;\n  stability: number;\n}\n\ninterface FactorModel {\n  factor: string;\n  exposure: number;\n  riskPremium: number;\n  tStat: number;\n  pValue: number;\n  rSquared: number;\n}\n\ninterface PortfolioWeight {\n  symbol: string;\n  name: string;\n  mvoWeight: number;\n  riskParityWeight: number;\n  blackLittermanWeight: number;\n  currentWeight: number;\n}\n\ninterface MonteCarloResult {\n  iteration: number;\n  portfolioReturn: number;\n  portfolioVolatility: number;\n  sharpeRatio: number;\n  maxDrawdown: number;\n}\n\ninterface PerformanceMetric {\n  metric: string;\n  value: number;\n  benchmark: number;\n  explanation: string;\n}\n\ninterface RiskFactor {\n  factor: string;\n  exposure: number;\n  contribution: number;\n  risk: number;\n  color: string;\n}\n\ninterface CrossAssetCorrelation {\n  asset1: string;\n  asset2: string;\n  correlation: number;\n  rollingCorrelation: number[];\n  regime: 'high' | 'medium' | 'low';\n}\n\n// New Types for Portfolio Risk Analytics\ninterface CorrelationMatrixEntry {\n  asset1: string;\n  asset2: string;\n  correlation: number;\n  rolling30d: number;\n  rolling90d: number;\n  regime: 'high' | 'medium' | 'low' | 'negative';\n  significance: number;\n}\n\ninterface SystemicRiskAlert {\n  id: string;\n  type: 'correlation_breakdown' | 'volatility_spike' | 'liquidity_crisis' | 'contagion_risk';\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  asset: string;\n  description: string;\n  timestamp: string;\n  value: number;\n  threshold: number;\n}\n\ninterface VaRDataPoint {\n  confidence: number;\n  varValue: number;\n  cvar: number;\n  historical: number;\n  parametric: number;\n  monteCarlo: number;\n}\n\ninterface DrawdownAnalysis {\n  date: string;\n  portfolioValue: number;\n  peakValue: number;\n  drawdown: number;\n  duration: number;\n  recoveryDate: string | null;\n  maxDrawdown: number;\n}\n\ninterface StressTestScenario {\n  id: string;\n  name: string;\n  description: string;\n  impact: number;\n  probability: number;\n  portfolioLoss: number;\n  varBreach: boolean;\n  assetsAffected: string[];\n}\n\ninterface RiskThreshold {\n  metric: string;\n  current: number;\n  threshold: number;\n  status: 'safe' | 'warning' | 'danger';\n  trend: 'up' | 'down' | 'stable';\n}\n\ninterface RebalancingRecommendation {\n  asset: string;\n  currentWeight: number;\n  targetWeight: number;\n  adjustment: number;\n  reason: string;\n  priority: 'high' | 'medium' | 'low';\n}\n\ninterface PortfolioRiskMetrics {\n  totalValue: number;\n  dailyVaR95: number;\n  dailyVaR99: number;\n  expectedShortfall: number;\n  volatility: number;\n  sharpeRatio: number;\n  maxDrawdown: number;\n  currentDrawdown: number;\n  beta: number;\n  correlationToMarket: number;\n  stressTestLoss: number;\n}\n\nconst AdvancedRiskManagementDashboard = () => {\n  // State for risk metrics\n  const [portfolioRiskMetrics, setPortfolioRiskMetrics] = useState<PortfolioRiskMetrics>({\n    totalValue: 1250000,\n    dailyVaR95: -28500,\n    dailyVaR99: -42500,\n    expectedShortfall: -51200,\n    volatility: 0.182,\n    sharpeRatio: 1.45,\n    maxDrawdown: -0.156,\n    currentDrawdown: -0.042,\n    beta: 0.85,\n    correlationToMarket: 0.72,\n    stressTestLoss: -0.218\n  });\n\n  // VaR data\n  const [varData, setVarData] = useState<VaRDataPoint[]>([\n    { confidence: 90, varValue: -18500, cvar: -22500, historical: -19200, parametric: -17800, monteCarlo: -18500 },\n    { confidence: 95, varValue: -28500, cvar: -34500, historical: -29100, parametric: -27500, monteCarlo: -28500 },\n    { confidence: 99, varValue: -42500, cvar: -51200, historical: -43200, parametric: -41500, monteCarlo: -42500 },\n    { confidence: 99.5, varValue: -51200, cvar: -62500, historical: -52100, parametric: -50500, monteCarlo: -51200 },\n    { confidence: 99.9, varValue: -68500, cvar: -84500, historical: -69200, parametric: -67500, monteCarlo: -68500 }\n  ]);\n\n  // Drawdown analysis data\n  const [drawdownData, setDrawdownData] = useState<DrawdownAnalysis[]>([\n    { date: '2024-01-15', portfolioValue: 1200000, peakValue: 1250000, drawdown: -0.04, duration: 5, recoveryDate: '2024-01-20', maxDrawdown: -0.156 },\n    { date: '2024-02-10', portfolioValue: 1180000, peakValue: 1250000, drawdown: -0.056, duration: 8, recoveryDate: '2024-02-18', maxDrawdown: -0.156 },\n    { date: '2024-03-05', portfolioValue: 1150000, peakValue: 1250000, drawdown: -0.08, duration: 12, recoveryDate: '2024-03-17', maxDrawdown: -0.156 },\n    { date: '2024-04-01', portfolioValue: 1050000, peakValue: 1250000, drawdown: -0.16, duration: 25, recoveryDate: null, maxDrawdown: -0.156 },\n    { date: '2024-04-15', portfolioValue: 1198000, peakValue: 1250000, drawdown: -0.042, duration: 15, recoveryDate: null, maxDrawdown: -0.156 }\n  ]);\n\n  // Correlation matrix data\n  const [correlationMatrix, setCorrelationMatrix] = useState<CorrelationMatrixEntry[]>([\n    { asset1: 'AAPL', asset2: 'MSFT', correlation: 0.72, rolling30d: 0.68, rolling90d: 0.71, regime: 'high', significance: 0.95 },\n    { asset1: 'AAPL', asset2: 'GOOGL', correlation: 0.65, rolling30d: 0.62, rolling90d: 0.64, regime: 'medium', significance: 0.92 },\n    { asset1: 'AAPL', asset2: 'TSLA', correlation: 0.45, rolling30d: 0.38, rolling90d: 0.42, regime: 'low', significance: 0.85 },\n    { asset1: 'AAPL', asset2: 'BTC', correlation: 0.18, rolling30d: 0.15, rolling90d: 0.17, regime: 'low', significance: 0.65 },\n    { asset1: 'MSFT', asset2: 'GOOGL', correlation: 0.78, rolling30d: 0.75, rolling90d: 0.77, regime: 'high', significance: 0.96 },\n    { asset1: 'MSFT', asset2: 'TSLA', correlation: 0.52, rolling30d: 0.48, rolling90d: 0.51, regime: 'medium', significance: 0.88 },\n    { asset1: 'MSFT', asset2: 'BTC', correlation: 0.22, rolling30d: 0.18, rolling90d: 0.21, regime: 'low', significance: 0.68 },\n    { asset1: 'GOOGL', asset2: 'TSLA', correlation: 0.58, rolling30d: 0.52, rolling90d: 0.56, regime: 'medium', significance: 0.89 },\n    { asset1: 'GOOGL', asset2: 'BTC', correlation: 0.25, rolling30d: 0.21, rolling90d: 0.23, regime: 'low', significance: 0.70 },\n    { asset1: 'TSLA', asset2: 'BTC', correlation: 0.35, rolling30d: 0.32, rolling90d: 0.34, regime: 'low', significance: 0.78 }\n  ]);\n\n  // Stress testing scenarios\n  const [stressTests, setStressTests] = useState<StressTestScenario[]>([\n    { id: '1', name: 'Market Crash 2008', description: 'Repeat of 2008 financial crisis conditions', impact: 0.85, probability: 0.02, portfolioLoss: -0.352, varBreach: true, assetsAffected: ['AAPL', 'MSFT', 'GOOGL', 'TSLA'] },\n    { id: '2', name: 'Tech Bubble Burst', description: 'Tech sector correction similar to 2000', impact: 0.65, probability: 0.05, portfolioLoss: -0.218, varBreach: true, assetsAffected: ['AAPL', 'MSFT', 'GOOGL'] },\n    { id: '3', name: 'Interest Rate Hike', description: 'Aggressive Fed rate increases', impact: 0.45, probability: 0.15, portfolioLoss: -0.125, varBreach: false, assetsAffected: ['AAPL', 'MSFT'] },\n    { id: '4', name: 'Crypto Winter', description: 'Major cryptocurrency market downturn', impact: 0.30, probability: 0.25, portfolioLoss: -0.085, varBreach: false, assetsAffected: ['BTC'] },\n    { id: '5', name: 'Geopolitical Crisis', description: 'Major international conflict escalation', impact: 0.55, probability: 0.08, portfolioLoss: -0.192, varBreach: true, assetsAffected: ['AAPL', 'MSFT', 'GOOGL', 'TSLA', 'BTC'] }\n  ]);\n\n  // Risk thresholds\n  const [riskThresholds, setRiskThresholds] = useState<RiskThreshold[]>([\n    { metric: 'Daily VaR (95%)', current: -28500, threshold: -35000, status: 'safe', trend: 'stable' },\n    { metric: 'Max Drawdown', current: -0.156, threshold: -0.20, status: 'safe', trend: 'up' },\n    { metric: 'Portfolio Volatility', current: 0.182, threshold: 0.25, status: 'safe', trend: 'down' },\n    { metric: 'Beta Exposure', current: 0.85, threshold: 1.0, status: 'safe', trend: 'stable' },\n    { metric: 'Correlation to Market', current: 0.72, threshold: 0.85, status: 'safe', trend: 'down' },\n    { metric: 'Liquidity Risk', current: 0.15, threshold: 0.30, status: 'safe', trend: 'stable' }\n  ]);\n\n  // Rebalancing recommendations\n  const [rebalancingRecs, setRebalancingRecs] = useState<RebalancingRecommendation[]>([\n    { asset: 'AAPL', currentWeight: 0.35, targetWeight: 0.30, adjustment: -0.05, reason: 'High concentration risk', priority: 'high' },\n    { asset: 'BTC', currentWeight: 0.15, targetWeight: 0.10, adjustment: -0.05, reason: 'Reduce crypto exposure', priority: 'high' },\n    { asset: 'MSFT', currentWeight: 0.25, targetWeight: 0.28, adjustment: 0.03, reason: 'Improve diversification', priority: 'medium' },\n    { asset: 'GOOGL', currentWeight: 0.15, targetWeight: 0.18, adjustment: 0.03, reason: 'Underweight position', priority: 'medium' },\n    { asset: 'TSLA', currentWeight: 0.10, targetWeight: 0.14, adjustment: 0.04, reason: 'Growth opportunity', priority: 'low' }\n  ]);\n\n  // Systemic risk alerts\n  const [systemicAlerts, setSystemicAlerts] = useState<SystemicRiskAlert[]>([\n    { id: '1', type: 'volatility_spike', severity: 'high', asset: 'TSLA', description: 'Volatility increased by 45% in 24h', timestamp: '2024-04-15 14:30', value: 0.85, threshold: 0.70 },\n    { id: '2', type: 'correlation_breakdown', severity: 'medium', asset: 'AAPL-BTC', description: 'Correlation dropped below historical average', timestamp: '2024-04-15 12:15', value: 0.18, threshold: 0.25 },\n    { id: '3', type: 'liquidity_crisis', severity: 'low', asset: 'BTC', description: 'Bid-ask spread widening detected', timestamp: '2024-04-15 10:45', value: 0.12, threshold: 0.10 }\n  ]);\n\n  // Real-time simulation\n  const [isLive, setIsLive] = useState(false);\n  const [timeframe, setTimeframe] = useState('1d');\n  const [confidenceLevel, setConfidenceLevel] = useState(95);\n\n  // Simulate real-time data updates\n  useEffect(() => {\n    if (!isLive) return;\n\n    const interval = setInterval(() => {\n      // Update VaR data\n      setVarData(prev => prev.map(item => ({\n        ...item,\n        varValue: item.varValue * (1 + (Math.random() - 0.5) * 0.05),\n        cvar: item.cvar * (1 + (Math.random() - 0.5) * 0.05)\n      })));\n\n      // Update portfolio metrics\n      setPortfolioRiskMetrics(prev => ({\n        ...prev,\n        dailyVaR95: prev.dailyVaR95 * (1 + (Math.random() - 0.5) * 0.02),\n        currentDrawdown: prev.currentDrawdown * (1 + (Math.random() - 0.5) * 0.1)\n      }));\n\n      // Update correlation matrix\n      setCorrelationMatrix(prev => prev.map(item => ({\n        ...item,\n        correlation: Math.max(-1, Math.min(1, item.correlation + (Math.random() - 0.5) * 0.05)),\n        rolling30d: Math.max(-1, Math.min(1, item.rolling30d + (Math.random() - 0.5) * 0.03))\n      })));\n    }, 5000);\n\n    return () => clearInterval(interval);\n  }, [isLive]);\n\n  // Format currency\n  const formatCurrency = (value: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0\n    }).format(value);\n  };\n\n  // Format percentage\n  const formatPercent = (value: number) => {\n    return `${(value * 100).toFixed(2)}%`;\n  };\n\n  // Get severity color\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical': return 'bg-red-500';\n      case 'high': return 'bg-orange-500';\n      case 'medium': return 'bg-yellow-500';\n      case 'low': return 'bg-blue-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  // Get status color\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'safe': return 'bg-green-500';\n      case 'warning': return 'bg-yellow-500';\n      case 'danger': return 'bg-red-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  // Get priority color\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'high': return 'bg-red-500';\n      case 'medium': return 'bg-yellow-500';\n      case 'low': return 'bg-blue-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  // Get correlation color\n  const getCorrelationColor = (correlation: number) => {\n    if (correlation > 0.7) return 'bg-red-400';\n    if (correlation > 0.4) return 'bg-yellow-400';\n    if (correlation > 0) return 'bg-green-400';\n    if (correlation > -0.3) return 'bg-blue-400';\n    return 'bg-purple-400';\n  };\n\n  // Calculate heatmap value\n  const calculateHeatmapValue = (correlation: number) => {\n    return Math.abs(correlation) * 100;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-white p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-3xl font-bold flex items-center gap-2\">\n                <ShieldIcon className=\"w-8 h-8 text-blue-500\" />\n                Advanced Risk Management Dashboard\n              </h1>\n              <p className=\"text-gray-400 mt-2\">Real-time portfolio risk assessment and monitoring</p>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <Button \n                variant={isLive ? \"destructive\" : \"default\"}\n                onClick={() => setIsLive(!isLive)}\n                className=\"flex items-center gap-2\"\n              >\n                {isLive ? <Pause className=\"w-4 h-4\" /> : <Play className=\"w-4 h-4\" />}\n                {isLive ? 'Pause Live' : 'Start Live'}\n              </Button>\n              <Button variant=\"outline\" className=\"flex items-center gap-2\">\n                <DownloadIcon className=\"w-4 h-4\" />\n                Export Report\n              </Button>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-4 mt-4\">\n            <Badge className=\"bg-green-500\">Last Updated: {new Date().toLocaleTimeString()}</Badge>\n            <Badge className=\"bg-blue-500\">Portfolio Value: {formatCurrency(portfolioRiskMetrics.totalValue)}</Badge>\n            <Badge className={portfolioRiskMetrics.currentDrawdown < -0.1 ? 'bg-red-500' : 'bg-yellow-500'}>\n              Current Drawdown: {formatPercent(portfolioRiskMetrics.currentDrawdown)}\n            </Badge>\n          </div>\n        </div>\n\n        {/* Main Dashboard Grid */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n          {/* Risk Metrics Overview */}\n          <Card className=\"lg:col-span-2\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <ActivityIcon className=\"w-5 h-5\" />\n                Portfolio Risk Metrics\n              </CardTitle>\n              <CardDescription>Real-time risk assessment and monitoring</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                <div className=\"bg-gray-800 p-4 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Daily VaR (95%)</div>\n                  <div className=\"text-2xl font-bold text-red-400\">{formatCurrency(portfolioRiskMetrics.dailyVaR95)}</div>\n                  <div className=\"text-xs text-gray-500\">Expected Shortfall: {formatCurrency(portfolioRiskMetrics.expectedShortfall)}</div>\n                </div>\n                <div className=\"bg-gray-800 p-4 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Max Drawdown</div>\n                  <div className=\"text-2xl font-bold text-yellow-400\">{formatPercent(portfolioRiskMetrics.maxDrawdown)}</div>\n                  <div className=\"text-xs text-gray-500\">Current: {formatPercent(portfolioRiskMetrics.currentDrawdown)}</div>\n                </div>\n                <div className=\"bg-gray-800 p-4 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Portfolio Volatility</div>\n                  <div className=\"text-2xl font-bold text-blue-400\">{formatPercent(portfolioRiskMetrics.volatility)}</div>\n                  <div className=\"text-xs text-gray-500\">Annualized</div>\n                </div>\n                <div className=\"bg-gray-800 p-4 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Sharpe Ratio</div>\n                  <div className=\"text-2xl font-bold text-green-400\">{portfolioRiskMetrics.sharpeRatio.toFixed(2)}</div>\n                  <div className=\"text-xs text-gray-500\">Risk-adjusted return</div>\n                </div>\n                <div className=\"bg-gray-800 p-4 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Beta Exposure</div>\n                  <div className=\"text-2xl font-bold text-purple-400\">{portfolioRiskMetrics.beta.toFixed(2)}</div>\n                  <div className=\"text-xs text-gray-500\">Market correlation: {formatPercent(portfolioRiskMetrics.correlationToMarket)}</div>\n                </div>\n                <div className=\"bg-gray-800 p-4 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Stress Test Loss</div>\n                  <div className=\"text-2xl font-bold text-orange-400\">{formatPercent(portfolioRiskMetrics.stressTestLoss)}</div>\n                  <div className=\"text-xs text-gray-500\">Worst-case scenario</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Risk Thresholds */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertOctagonIcon className=\"w-5 h-5\" />\n                Risk Threshold Monitoring\n              </CardTitle>\n              <CardDescription>Real-time threshold alerts</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {riskThresholds.map((threshold, index) => (\n                  <div key={index} className=\"space-y-2\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm\">{threshold.metric}</span>\n                      <Badge className={getStatusColor(threshold.status)}>\n                        {threshold.status.toUpperCase()}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Progress \n                        value={Math.abs(threshold.current) / Math.abs(threshold.threshold) * 100} \n                        className=\"flex-1\"\n                      />\n                      <span className=\"text-sm\">\n                        {typeof threshold.current === 'number' && threshold.current < 0 \n                          ? formatCurrency(threshold.current)\n                          : formatPercent(threshold.current)}\n                      </span>\n                    </div>\n                    <div className=\"text-xs text-gray-500 flex justify-between\">\n                      <span>Threshold: {typeof threshold.threshold === 'number' && threshold.threshold < 0 \n                        ? formatCurrency(threshold.threshold)\n                        : formatPercent(threshold.threshold)}</span>\n                      <span className=\"flex items-center gap-1\">\n                        {threshold.trend === 'up' ? <TrendingUpIcon4 className=\"w-3 h-3 text-green-500\" /> : \n                         threshold.trend === 'down' ? <TrendingDownIcon4 className=\"w-3 h-3 text-red-500\" /> : \n                         <span className=\"text-gray-500\">â†’</span>}\n                      </span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* VaR Analysis and Correlation Matrix */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6\">\n          {/* VaR Analysis */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <CalculatorIcon className=\"w-5 h-5\" />\n                Value at Risk (VaR) Analysis\n              </CardTitle>\n              <CardDescription>VaR across different confidence levels</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"h-64\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <ComposedChart data={varData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#374151\" />\n                    <XAxis \n                      dataKey=\"confidence\" \n                      stroke=\"#9CA3AF\"\n                      label={{ value: 'Confidence Level (%)', position: 'insideBottom', offset: -5 }}\n                    />\n                    <YAxis \n                      stroke=\"#9CA3AF\"\n                      tickFormatter={(value) => formatCurrency(value)}\n                    />\n                    <Tooltip \n                      formatter={(value) => [formatCurrency(value as number), 'VaR']}\n                      contentStyle={{ backgroundColor: '#1F2937', borderColor: '#374151' }}\n                    />\n                    <Legend />\n                    <Bar dataKey=\"varValue\" fill=\"#EF4444\" name=\"VaR\" />\n                    <Line type=\"monotone\" dataKey=\"cvar\" stroke=\"#F59E0B\" strokeWidth={2} name=\"CVaR\" />\n                  </ComposedChart>\n                </ResponsiveContainer>\n              </div>\n              <div className=\"mt-4 grid grid-cols-2 gap-4\">\n                <div className=\"text-center p-3 bg-gray-800 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Historical VaR</div>\n                  <div className=\"text-lg font-bold\">{formatCurrency(varData[1]?.historical || 0)}</div>\n                </div>\n                <div className=\"text-center p-3 bg-gray-800 rounded-lg\">\n                  <div className=\"text-sm text-gray-400\">Monte Carlo VaR</div>\n                  <div className=\"text-lg font-bold\">{formatCurrency(varData[1]?.monteCarlo || 0)}</div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Correlation Matrix */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <NetworkIcon className=\"w-5 h-5\" />\n                Asset Correlation Matrix\n              </CardTitle>\n              <CardDescription>Real-time correlation analysis</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr>\n                      <th className=\"text-left p-2\">Asset Pair</th>\n                      <th className=\"text-left p-2\">Correlation</th>\n                      <th className=\"text-left p-2\">30D Rolling</th>\n                      <th className=\"text-left p-2\">Regime</th>\n                      <th className=\"text-left p-2\">Heatmap</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {correlationMatrix.map((item, index) => (\n                      <tr key={index} className=\"border-b border-gray-800 hover:bg-gray-800\">\n                        <td className=\"p-2\">\n                          <div className=\"font-medium\">{item.asset1} - {item.asset2}</div>\n                        </td>\n                        <td className=\"p-2\">\n                          <div className={`px-2 py-1 rounded ${getCorrelationColor(item.correlation)}`}>\n                            {item.correlation.toFixed(3)}\n